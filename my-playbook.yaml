---
- name: Developer Workstation Setup
  hosts: localhost

  vars_files:
    - secrets.yaml

  tasks:

  - name: Add Microsoft Visual Studio Code Repo
    become: yes
    yum_repository:
      name: vscode
      description: Visual Studio Code
      baseurl: https://packages.microsoft.com/yumrepos/vscode
      gpgcheck: yes
      gpgkey: https://packages.microsoft.com/keys/microsoft.asc

  - name: Enable RPM Fusion Repos
    dnf:
      name: "https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ansible_distribution_major_version}}.noarch.rpm"
      state: present
    become: yes
    when: ansible_distribution == 'Fedora'

  - name: Install Packages
    become: yes
    dnf:
      name:
        - code
        - discord
        - nodejs
        - golang
        - jq
        - vim-enhanced
        - dotnet-sdk-3.1
      state: latest

  - git_config:
      name: user.name
      scope: global
      value: "{{ full_name }}"
    become: false

  - git_config:
      name: user.email
      scope: global
      value: "{{ email }}"
    become: false

  - file:
      path: "{{ ansible_user_dir }}/.local/bin"
      state: directory
    become: no

  - get_url:
      url: "https://github.com/uber/prototool/releases/download/v1.10.0/prototool-{{ ansible_system }}-{{ ansible_architecture }}"
      dest: "{{ ansible_user_dir }}/.local/bin/prototool"
      mode: 0755
    become: no

  - name: Increase max file watches to maximum allowed (for vscode)
    become: yes
    sysctl:
      name: fs.inotify.max_user_watches
      value: 524288
      state: present

  - name: copy developer_bash_profile.sh
    become: no
    copy:
      src: developer_bash_profile.sh
      dest: "{{ ansible_user_dir }}/developer_bash_profile.sh"

  - name: Run Developer Bash Profile
    become: no
    blockinfile:
      path: ~/.bashrc
      backup: yes
      state: present
      block: |
        # developer settings
        if [ -f ~/developer_bash_profile.sh ]; then
          . ~/developer_bash_profile.sh
        fi
      